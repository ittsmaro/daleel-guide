<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุงูุฏููู ุงูุชูุงุนูู: ุฏููู ุงูุทุงูุจ ูููู ุงููุทุงูุจ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- FONTS: Using Rubik for EVERYTHING -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'heritage-dark': '#3E2723', // Dark Brown
                        'heritage-gold': '#BCAAA4', // Muted Gold/Beige
                        'heritage-green': '#2E7D32', // Islamic Green
                        'heritage-paper': '#F9F7F2', // Old Paper
                        'heritage-accent': '#C62828', // Red Ink
                    },
                    fontFamily: {
                        'sans': ['Rubik', 'sans-serif'],
                        'serif': ['Rubik', 'sans-serif'],
                    },
                    screens: {
                        'xs': '475px', // Extra small screens support
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F9F7F2;
            color: #3E2723;
            font-family: 'Rubik', sans-serif;
            -webkit-font-smoothing: antialiased; /* Smoother fonts on iOS */
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Chart container responsive height */
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Mobile Touch Improvements */
        button, select, input, textarea {
            touch-action: manipulation; /* Improves touch response */
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(62, 39, 35, 0.1);
        }
        
        .tab-active {
            border-bottom: 3px solid #2E7D32;
            color: #2E7D32;
            font-weight: 700;
        }
        .tab-inactive {
            color: #8D6E63;
        }

        /* Markdown Styles */
        .prose strong { color: #2E7D32; font-weight: 700; }
        .prose ul { list-style-type: disc; padding-right: 1.5rem; margin-top: 0.5rem; }
        .prose li { margin-bottom: 0.25rem; }
        .prose p { margin-bottom: 0.75rem; }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2E7D32;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .quiz-option {
            transition: all 0.2s;
            cursor: pointer;
            user-select: none; /* Prevent text selection on mobile tap */
        }
        .quiz-option:active {
            background-color: #e5e7eb; /* Instant feedback on tap */
        }
        .quiz-option.selected {
            border-color: #2E7D32;
            background-color: #e8f5e9;
        }
        .quiz-option.correct {
            border-color: #2E7D32;
            background-color: #c8e6c9;
            color: #1b5e20;
        }
        .quiz-option.incorrect {
            border-color: #c62828;
            background-color: #ffcdd2;
            color: #b71c1c;
        }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-heritage-dark text-white shadow-lg relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]"></div>
        <div class="container mx-auto px-4 md:px-6 py-8 md:py-10 relative z-10 text-center">
            <h1 class="text-3xl sm:text-4xl md:text-6xl font-black mb-3 md:mb-4 text-heritage-gold tracking-wide leading-tight">ุฏููู ุงูุทุงูุจ ูููู ุงููุทุงูุจ</h1>
            <p class="text-lg md:text-2xl font-light text-gray-300 mb-6 max-w-2xl mx-auto">ุงููุฑุฌุน ุงูุชูุงุนูู ุงูุดุงูู ูููุชูู ูุงูุดุฑูุญ ูุงููุณุฎ ุงููุนุชูุฏุฉ</p>
            <div class="flex justify-center gap-3 flex-wrap font-medium">
                <span class="bg-heritage-green px-3 py-1 rounded-full text-xs md:text-sm shadow-md">ุงูููู ุงูุญูุจูู</span>
                <span class="bg-heritage-green px-3 py-1 rounded-full text-xs md:text-sm shadow-md">ูุฑุนู ุงููุฑูู</span>
                <span class="bg-heritage-green px-3 py-1 rounded-full text-xs md:text-sm shadow-md">ุงููุชูู ุงููุนุชูุฏุฉ</span>
            </div>
        </div>
    </header>

    <!-- Navigation (Sticky & Scrollable on Mobile) -->
    <nav class="bg-white shadow sticky top-0 z-50 backdrop-blur-md bg-opacity-95 border-b border-gray-100">
        <div class="container mx-auto px-4">
            <div class="flex justify-start md:justify-center overflow-x-auto whitespace-nowrap py-3 gap-4 md:gap-8 text-base md:text-lg no-scrollbar">
                <button onclick="switchSection('overview')" id="nav-overview" class="tab-active hover:text-heritage-green transition px-2 py-1 flex-shrink-0">ูุธุฑุฉ ุนุงูุฉ</button>
                <button onclick="switchSection('editions')" id="nav-editions" class="tab-inactive hover:text-heritage-green transition px-2 py-1 flex-shrink-0">ุฃูุถู ุงูุทุจุนุงุช</button>
                <button onclick="switchSection('explanations')" id="nav-explanations" class="tab-inactive hover:text-heritage-green transition px-2 py-1 flex-shrink-0">ุฎุฑูุทุฉ ุงูุดุฑูุญ</button>
                <button onclick="switchSection('advisor')" id="nav-advisor" class="tab-inactive hover:text-heritage-green transition px-2 py-1 flex-shrink-0">ุงููุณุชุดุงุฑ ุงูุฐูู</button>
                <button onclick="switchSection('aitutor')" id="nav-aitutor" class="tab-inactive hover:text-heritage-green transition px-2 py-1 flex-shrink-0 flex items-center gap-1 font-bold text-heritage-green">
                     ุงููุนูู ุงูุฐูู โจ
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="container mx-auto px-4 py-6 md:py-8 flex-grow">

        <!-- SECTION: OVERVIEW & CHART -->
        <section id="overview" class="block animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8">
                <!-- Text Content -->
                <div class="lg:col-span-4 bg-white p-5 md:p-6 rounded-xl shadow-sm border-t-4 border-heritage-green h-fit">
                    <h2 class="text-xl md:text-2xl font-bold mb-4 text-heritage-dark">ุนู ุงููุชุงุจ</h2>
                    <p class="mb-4 leading-relaxed text-gray-700 text-base md:text-lg text-justify">
                        ูุชุงุจ <strong>"ุฏููู ุงูุทุงูุจ ูููู ุงููุทุงูุจ"</strong> ููุนูุงูุฉ ูุฑุนู ุจู ููุณู ุงููุฑูู (ุช 1033ูู) ูู ุฃุญุฏ ุฃูู ุงููุชูู ุงููุนุชูุฏุฉ ุนูุฏ ุงููุชุฃุฎุฑูู ูู ุงูุญูุงุจูุฉ.
                    </p>
                    <p class="mb-4 leading-relaxed text-gray-700 text-base md:text-lg text-justify">
                        ูุชููุฒ ุจุญุณู ุงูุชูุณููุ ููุถูุญ ุงูุนุจุงุฑุฉุ ูุงูุงูุชุตุงุฑ ุนูู ุงูููู ุงูุฑุงุฌุญ ูู ุงููุฐูุจ ุฏูู ุชุดููุด ุจุฐูุฑ ุงูุฎูุงู.
                    </p>
                    <div class="bg-heritage-paper p-4 rounded-lg border border-heritage-gold mt-4">
                        <h3 class="font-bold text-heritage-dark mb-2 text-sm md:text-base">๐ฏ ููุงูุชู ูู ุงูุณูู ุงูุชุนูููู</h3>
                        <p class="text-sm md:text-base text-gray-800">ูุฃุชู ุนุงุฏุฉ ุจุนุฏ "ุฃุฎุตุฑ ุงููุฎุชุตุฑุงุช" ููุจู "ุงูุฑูุถ ุงููุฑุจุน". ููุงุณุจ ูููุจุชุฏุฆ ุงูุฌุงุฏ ูุงููุชูุณุท.</p>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="lg:col-span-8 bg-white p-4 md:p-6 rounded-xl shadow-sm">
                    <div class="mb-4">
                        <h2 class="text-xl md:text-2xl font-bold text-heritage-dark">ุฎุฑูุทุฉ ุงูุดุฑูุญ ุงูุชุญููููุฉ</h2>
                        <p class="text-gray-500 text-xs md:text-sm">ููุงุฑูุฉ ุจูู ุงูุดุฑูุญ ุจูุงุกู ุนูู "ุนูู ุงูุทุฑุญ" ู "ุงูุชุฑููุฒ ุนูู ุงูุฏููู"</p>
                    </div>
                    
                    <!-- Responsive height for chart container -->
                    <div class="chart-container h-64 sm:h-80 md:h-96">
                        <canvas id="commentaryChart"></canvas>
                    </div>
                    <div class="mt-4 text-center text-xs text-gray-500">
                        ุงุถุบุท ุนูู ุงูููุงุท ูู ุงูุฑุณู ุงูุจูุงูู ูุฑุคูุฉ ุงูุชูุงุตูู
                    </div>
                </div>
            </div>

            <!-- Stats Row -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 md:gap-4 mt-6 md:mt-8">
                <div class="bg-white p-4 rounded-lg text-center shadow-sm border-b-2 border-heritage-gold/20">
                    <div class="text-2xl md:text-3xl font-bold text-heritage-green">400+</div>
                    <div class="text-gray-600 text-xs md:text-sm">ุนุงู ูู ุงูุงุนุชูุงุฏ</div>
                </div>
                <div class="bg-white p-4 rounded-lg text-center shadow-sm border-b-2 border-heritage-gold/20">
                    <div class="text-2xl md:text-3xl font-bold text-heritage-green">10+</div>
                    <div class="text-gray-600 text-xs md:text-sm">ุดุฑูุญ ูุทุจูุนุฉ</div>
                </div>
                <div class="bg-white p-4 rounded-lg text-center shadow-sm border-b-2 border-heritage-gold/20">
                    <div class="text-2xl md:text-3xl font-bold text-heritage-green">3</div>
                    <div class="text-gray-600 text-xs md:text-sm">ุทุจุนุงุช ูุญููุฉ</div>
                </div>
                <div class="bg-white p-4 rounded-lg text-center shadow-sm border-b-2 border-heritage-gold/20">
                    <div class="text-2xl md:text-3xl font-bold text-heritage-green">โ</div>
                    <div class="text-gray-600 text-xs md:text-sm">ุฃุฌุฑ ูุจุฑูุฉ ููุนูู</div>
                </div>
            </div>
        </section>

        <!-- SECTION: EDITIONS (NUSAKH) -->
        <section id="editions" class="hidden animate-fade-in">
            <div class="mb-6 md:mb-8 bg-white p-5 md:p-6 rounded-xl border-r-4 border-heritage-accent">
                <h2 class="text-2xl md:text-3xl font-bold text-heritage-dark mb-2">ุฃูุถู ุงูุทุจุนุงุช (ุงููุณุฎ)</h2>
                <p class="text-gray-600 text-base md:text-lg">ุงุฎุชูุงุฑ ุงููุณุฎุฉ ุงูุตุญูุญุฉ ูู ูุตู ุงูุทุฑูู. ุงููุณุฎ ุงููููุฆุฉ ุจุงูุฃุฎุทุงุก ุชุดูุด ุงูููู.</p>
            </div>

            <!-- Controls (Scrollable on mobile) -->
            <div class="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
                <button onclick="filterEditions('all')" class="px-5 py-2.5 bg-heritage-dark text-white rounded-lg hover:bg-opacity-90 shadow-sm font-medium flex-shrink-0 whitespace-nowrap text-sm md:text-base">ุงููู</button>
                <button onclick="filterEditions('student')" class="px-5 py-2.5 bg-white text-heritage-dark border border-heritage-dark rounded-lg hover:bg-gray-50 font-medium flex-shrink-0 whitespace-nowrap text-sm md:text-base">ููุทุงูุจ (ูุฎุฏููุฉ)</button>
                <button onclick="filterEditions('academic')" class="px-5 py-2.5 bg-white text-heritage-dark border border-heritage-dark rounded-lg hover:bg-gray-50 font-medium flex-shrink-0 whitespace-nowrap text-sm md:text-base">ููุชุญููู (ุฃูุงุฏูููุฉ)</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" id="editions-grid">
                <!-- Content injected via JS -->
            </div>
        </section>

        <!-- SECTION: EXPLANATIONS (SHURUH) -->
        <section id="explanations" class="hidden animate-fade-in">
            <div class="mb-6 md:mb-8 bg-white p-5 md:p-6 rounded-xl border-r-4 border-heritage-green">
                <h2 class="text-2xl md:text-3xl font-bold text-heritage-dark mb-2">ุฏููู ุงูุดุฑูุญ</h2>
                <p class="text-gray-600 text-base md:text-lg">ูููุณู ุงูุดุฑุงุญ ุฅูู ูุณููู: ุดุฑุงุญ ุงููุชู ุงูุฃุตูููู (ุงููุฏุงูู) ูุงูุดุฑุงุญ ุงููุนุงุตุฑูู.</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Sidebar Filters -->
                <div class="lg:w-1/4 space-y-2">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold text-lg mb-4 text-heritage-dark">ุชุตููู ุงูุดุฑุญ</h3>
                        <div class="space-y-1">
                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer p-3 hover:bg-gray-50 rounded-lg active:bg-gray-100 transition">
                                <input type="radio" name="shuruh-type" value="all" checked onclick="filterShuruh()" class="text-heritage-green focus:ring-heritage-green w-5 h-5">
                                <span class="font-medium mr-2">ุงููู</span>
                            </label>
                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer p-3 hover:bg-gray-50 rounded-lg active:bg-gray-100 transition">
                                <input type="radio" name="shuruh-type" value="classic" onclick="filterShuruh()" class="text-heritage-green focus:ring-heritage-green w-5 h-5">
                                <span class="font-medium mr-2">ุดุฑูุญ ุชุฑุงุซูุฉ</span>
                            </label>
                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer p-3 hover:bg-gray-50 rounded-lg active:bg-gray-100 transition">
                                <input type="radio" name="shuruh-type" value="contemporary" onclick="filterShuruh()" class="text-heritage-green focus:ring-heritage-green w-5 h-5">
                                <span class="font-medium mr-2">ุดุฑูุญ ูุนุงุตุฑุฉ</span>
                            </label>
                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer p-3 hover:bg-gray-50 rounded-lg active:bg-gray-100 transition">
                                <input type="radio" name="shuruh-type" value="audio" onclick="filterShuruh()" class="text-heritage-green focus:ring-heritage-green w-5 h-5">
                                <span class="font-medium mr-2">ุดุฑูุญ ุตูุชูุฉ</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Results List -->
                <div class="lg:w-3/4 space-y-4" id="shuruh-list">
                    <!-- Content injected via JS -->
                </div>
            </div>
        </section>

        <!-- SECTION: ADVISOR -->
        <section id="advisor" class="hidden animate-fade-in">
            <div class="max-w-2xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg border-t-8 border-heritage-dark">
                <h2 class="text-2xl md:text-3xl font-bold text-center text-heritage-dark mb-4">ุงููุณุชุดุงุฑ ุงูุฐูู ๐ก</h2>
                <p class="text-center text-gray-600 mb-8 text-base md:text-lg">ุฃุฌุจ ุนู ุงูุฃุณุฆูุฉ ุงูุชุงููุฉ ูููุชุฑุญ ุนููู ุงูุฎุทุฉ ุงูุฃูุณุจ.</p>

                <div id="advisor-form">
                    <div class="mb-6">
                        <label class="block text-base md:text-lg font-medium mb-3 text-heritage-dark">ูุง ูู ูุณุชูุงู ุงูุญุงููุ</label>
                        <select id="user-level" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-heritage-green outline-none bg-gray-50 text-base md:text-lg appearance-none">
                            <option value="beginner">ูุจุชุฏุฆ (ุฃูู ูุชู ูููู ูู)</option>
                            <option value="intermediate">ูุชูุณุท (ุฏุฑุณุช ุฃุฎุตุฑ ุงููุฎุชุตุฑุงุช)</option>
                            <option value="advanced">ูุชูุฏู (ุฃุฑูุฏ ุงููุฑุงุฌุนุฉ ูุงูุชุฏููู)</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-base md:text-lg font-medium mb-3 text-heritage-dark">ูุง ูู ูุฏูู ุงูุฑุฆูุณูุ</label>
                        <select id="user-goal" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-heritage-green outline-none bg-gray-50 text-base md:text-lg appearance-none">
                            <option value="understanding">ููู ุงููุณุงุฆู (ูู ุงูุนุจุงุฑุฉ)</option>
                            <option value="evidence">ูุนุฑูุฉ ุงูุฏููู ูุงูุชุนููู</option>
                            <option value="memorization">ุงูุญูุธ ูุถุจุท ุงููุชู</option>
                        </select>
                    </div>

                    <button onclick="getRecommendation()" class="w-full bg-heritage-green text-white font-bold py-4 rounded-lg hover:bg-opacity-90 transition transform active:scale-95 shadow-md text-lg">
                        ุงุญุตู ุนูู ุงูุชูุตูุฉ
                    </button>
                </div>

                <div id="advisor-result" class="hidden mt-8 bg-heritage-paper p-6 rounded-xl border border-dashed border-heritage-dark">
                    <h3 class="text-xl font-bold text-heritage-dark mb-4">ุงูุชูุตูุฉ ุงูููุชุฑุญุฉ:</h3>
                    <div id="recommendation-content" class="text-gray-800 space-y-4 text-base md:text-lg"></div>
                    <button onclick="resetAdvisor()" class="mt-4 text-sm text-gray-500 underline hover:text-heritage-accent p-2">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
                </div>
            </div>
        </section>

        <!-- SECTION: AI TUTOR -->
        <section id="aitutor" class="hidden animate-fade-in">
            <div class="mb-6 md:mb-8 bg-white p-5 md:p-6 rounded-xl border-r-4 border-heritage-green flex flex-col md:flex-row justify-between items-start md:items-center shadow-sm gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold text-heritage-dark mb-2">ุงููุนูู ุงููููู ุงูุฐูู โจ</h2>
                    <p class="text-gray-600 text-sm md:text-lg">ุงุณุชุฎุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูููู ุนุจุงุฑุงุช ุงููุชุงุจ ุงูุตุนุจุฉ ุฃู ููุงุฎุชุจุงุฑ.</p>
                </div>
                <div class="bg-blue-50 text-blue-800 px-4 py-2 rounded-full text-xs font-bold border border-blue-200 shadow-sm self-start md:self-auto">
                    ูุฏุนูู ุจูุงุณุทุฉ Gemini AI
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                
                <!-- Tool 1: Phrase Explainer -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 flex flex-col h-full">
                    <div class="bg-heritage-dark p-4 text-white">
                        <h3 class="text-lg md:text-xl font-bold flex items-center gap-2">
                            <span>๐</span> ุดุฑุญ ุงูุนุจุงุฑุฉ (ูู ุงูุฎุท)
                        </h3>
                    </div>
                    <div class="p-4 md:p-6 flex-grow flex flex-col">
                        <p class="text-xs md:text-sm text-gray-500 mb-3">ุฃุฏุฎู ุฃู ุฌููุฉ ุตุนุจุฉ ูู ุงููุชู ููููู ุงููุนูู ุจุดุฑุญูุง.</p>
                        <textarea id="ai-explain-input" class="w-full h-32 p-3 md:p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-heritage-green outline-none mb-4 bg-gray-50 text-base md:text-lg resize-none" placeholder="ุงูุตู ูุต ุงููุชู ููุง..."></textarea>
                        <button onclick="askGemini('explain')" class="w-full bg-heritage-green text-white font-bold py-3 md:py-4 rounded-lg hover:bg-opacity-90 active:scale-95 transition flex justify-center items-center gap-2 mt-auto shadow-md text-base md:text-lg">
                            <span id="btn-text-explain">ุงุดุฑุญ ูู ุงูุนุจุงุฑุฉ</span>
                            <span id="loader-explain" class="loader hidden"></span>
                        </button>
                        
                        <div id="result-explain" class="hidden mt-6 bg-heritage-paper p-4 md:p-5 rounded-lg border border-dashed border-heritage-dark prose text-gray-800 text-sm md:text-base leading-relaxed max-h-60 overflow-y-auto"></div>
                    </div>
                </div>

                <!-- Tool 2: General Q&A -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 flex flex-col h-full">
                    <div class="bg-heritage-gold p-4 text-heritage-dark">
                        <h3 class="text-lg md:text-xl font-bold flex items-center gap-2">
                            <span>โ</span> ุงูููุชู ุงูุฏุฑุงุณู (ุณุคุงู ูุฌูุงุจ)
                        </h3>
                    </div>
                    <div class="p-4 md:p-6 flex-grow flex flex-col">
                        <p class="text-xs md:text-sm text-gray-500 mb-3">ุงุณุฃู ุนู ุฃู ุญูู ุฃู ูุณุฃูุฉ ูู "ุฏููู ุงูุทุงูุจ".</p>
                        <textarea id="ai-qa-input" class="w-full h-32 p-3 md:p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-heritage-green outline-none mb-4 bg-gray-50 text-base md:text-lg resize-none" placeholder="ุงูุชุจ ุณุคุงูู ุงููููู ููุง..."></textarea>
                        <button onclick="askGemini('qa')" class="w-full bg-heritage-dark text-white font-bold py-3 md:py-4 rounded-lg hover:bg-opacity-90 active:scale-95 transition flex justify-center items-center gap-2 mt-auto shadow-md text-base md:text-lg">
                            <span id="btn-text-qa">ุฃุฑุณู ุงูุณุคุงู</span>
                            <span id="loader-qa" class="loader hidden"></span>
                        </button>

                        <div id="result-qa" class="hidden mt-6 bg-blue-50 p-4 md:p-5 rounded-lg border border-blue-200 prose text-gray-800 text-sm md:text-base leading-relaxed max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <!-- Tool 3: Smart Quiz -->
            <div class="mt-6 md:mt-8 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
                <div class="bg-heritage-green p-4 text-white flex justify-between items-center">
                    <h3 class="text-lg md:text-xl font-bold flex items-center gap-2">
                        <span>๐</span> ุงุฎุชุจุฑ ูุนูููุงุชู
                    </h3>
                    <span class="bg-white text-heritage-green text-xs px-2 py-1 rounded font-bold shadow-sm">ุฌุฏูุฏ โจ</span>
                </div>
                <div class="p-4 md:p-6">
                    <div class="flex flex-col md:flex-row gap-4 items-end mb-4">
                        <div class="flex-grow w-full">
                            <label class="block text-base md:text-lg font-medium text-gray-700 mb-2">ุงุฎุชุฑ ุงูุจุงุจ ุงููููู:</label>
                            <select id="quiz-topic" class="w-full p-3 md:p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-heritage-green outline-none bg-gray-50 text-base md:text-lg appearance-none">
                                <option value="ุงูุทูุงุฑุฉ">ูุชุงุจ ุงูุทูุงุฑุฉ</option>
                                <option value="ุงูุตูุงุฉ">ูุชุงุจ ุงูุตูุงุฉ</option>
                                <option value="ุงูุฒูุงุฉ">ูุชุงุจ ุงูุฒูุงุฉ</option>
                                <option value="ุงูุตูุงู">ูุชุงุจ ุงูุตูุงู</option>
                                <option value="ุงูุญุฌ">ูุชุงุจ ุงูุญุฌ</option>
                                <option value="ุงูุจููุน">ูุชุงุจ ุงูุจููุน</option>
                            </select>
                        </div>
                        <button onclick="generateQuiz()" class="w-full md:w-auto bg-heritage-green text-white font-bold py-3 md:py-4 px-6 md:px-8 rounded-lg hover:bg-opacity-90 active:scale-95 transition flex justify-center items-center gap-2 whitespace-nowrap shadow-md text-base md:text-lg">
                            <span id="btn-text-quiz">ููุฏ ุณุคุงูุงู ุฌุฏูุฏุงู</span>
                            <span id="loader-quiz" class="loader hidden" style="border-top-color: white;"></span>
                        </button>
                    </div>

                    <!-- Quiz Display Area -->
                    <div id="quiz-container" class="hidden mt-6 bg-gray-50 p-4 md:p-6 rounded-xl border border-gray-200">
                        <div class="mb-4">
                            <span class="text-xs text-heritage-green font-bold bg-green-100 px-2 py-1 rounded">ุณุคุงู ูู: <span id="quiz-topic-display"></span></span>
                        </div>
                        <h4 id="quiz-question" class="text-lg md:text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h4>
                        <div id="quiz-options" class="space-y-3">
                            <!-- Options injected here -->
                        </div>
                        <div id="quiz-feedback" class="hidden mt-6 p-4 rounded-lg bg-blue-50 text-blue-900 border border-blue-200">
                            <p class="font-bold mb-1 text-base md:text-lg">ุงูุดุฑุญ ูุงูุชุนููู:</p>
                            <p id="quiz-explanation" class="text-sm md:text-base"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 text-center text-xs text-gray-400">
                ููุงุญุธุฉ: ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุฏ ูุฎุทุฆ. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุดุฑูุญ ุงููุนุชูุฏุฉ ููุฃุญูุงู ุงูููุงุฆูุฉ.
            </div>
        </section>

    </main>

    <footer class="bg-heritage-dark text-heritage-gold py-8 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-xl md:text-2xl font-bold">"ูู ูุฑุฏ ุงููู ุจู ุฎูุฑุงู ููููู ูู ุงูุฏูู"</p>
            <p class="text-xs md:text-sm mt-3 opacity-70">ุชู ุชุตููู ูุฐุง ุงูุฏููู ูุชุณููู ุทูุจ ุงูุนูู - ุฌููุน ุงูุญููู ูุญููุธุฉ ูุทูุงุจ ุงูุนูู</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        
        // ==========================================
        // ูุงู ุฌุฏุงู: ุงูููุชุงุญ
        // ==========================================
        const apiKey = "AIzaSyAiOPoAmhQpMC4AJA2Ul5piyIAJX1ahaqk"; 
        // ==========================================

        
        // --- GEMINI API LOGIC ---
        async function callGeminiAPI(payload) {
            
            if (!apiKey) {
                alert("ุนุฐุฑุงูุ ุงูููุชุงุญ ููููุฏ.");
                throw new Error("Missing API Key");
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // Retry logic (Exponential Backoff)
            const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i <= 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errText = await response.text();
                        console.error("Gemini API Error:", errText);
                        // Show user friendly error for quota or auth issues
                        if (response.status === 403 || response.status === 400) {
                             throw new Error("ุฎุทุฃ ูู ุงูููุชุงุญ ุฃู ุงูุตูุงุญูุงุช. ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช ุงูููุชุงุญ ูู ุฌูุฌู.");
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || null;

                } catch (error) {
                    if (error.message.includes("ุฎุทุฃ ูู ุงูููุชุงุญ")) {
                        alert(error.message);
                        throw error;
                    }
                    if (i === 5) throw error; // Rethrow after final attempt
                    await new Promise(r => setTimeout(r, delays[i]));
                }
            }
        }

        async function askGemini(type) {
            const inputId = type === 'explain' ? 'ai-explain-input' : 'ai-qa-input';
            const resultId = type === 'explain' ? 'result-explain' : 'result-qa';
            const btnTextId = type === 'explain' ? 'btn-text-explain' : 'btn-text-qa';
            const loaderId = type === 'explain' ? 'loader-explain' : 'loader-qa';

            const userInput = document.getElementById(inputId).value.trim();
            const resultDiv = document.getElementById(resultId);
            const btnText = document.getElementById(btnTextId);
            const loader = document.getElementById(loaderId);

            if (!userInput) {
                alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุต ุฃููุงู.");
                return;
            }

            // UI Loading State
            btnText.classList.add('hidden');
            loader.classList.remove('hidden');
            resultDiv.classList.add('hidden');

            let prompt = "";
            let systemInstruction = "ุฃูุช ูุนูู ูููู ูุชุฎุตุต ูู ุงููุฐูุจ ุงูุญูุจููุ ูุชุญุฏูุฏุงู ุฎุจูุฑ ูู ูุชุงุจ 'ุฏููู ุงูุทุงูุจ ูููู ุงููุทุงูุจ'. ุฃุฌุจ ุจูุถูุญ ูุฏูุฉ.";

            if (type === 'explain') {
                prompt = `ุงุดุฑุญ ูู ูุฐู ุงูุนุจุงุฑุฉ ูู ูุชู ุฏููู ุงูุทุงูุจ ุดุฑุญุงู ูุจุณุทุงู ูููู ุฃููุงุธูุง ูููุถุญ ุญูููุง: "${userInput}"`;
            } else {
                prompt = `ุฃุฌุจ ุนู ูุฐุง ุงูุณุคุงู ุงููููู ุจูุงุกู ุนูู ูุง ูุฑุฏ ูู ูุชุงุจ ุฏููู ุงูุทุงูุจ ูููุฐูุจ ุงูุญูุจูู: "${userInput}"`;
            }

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const responseText = await callGeminiAPI(payload);
                if(responseText) {
                    resultDiv.innerHTML = marked.parse(responseText);
                    resultDiv.classList.remove('hidden');
                } else {
                    throw new Error("Empty response");
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600 font-bold">ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู. ${error.message}</span>`;
                resultDiv.classList.remove('hidden');
                console.error(error);
            } finally {
                loader.classList.add('hidden');
                btnText.classList.remove('hidden');
            }
        }

        // --- QUIZ LOGIC ---
        let currentQuizData = null;

        async function generateQuiz() {
            const topic = document.getElementById('quiz-topic').value;
            const btnText = document.getElementById('btn-text-quiz');
            const loader = document.getElementById('loader-quiz');
            const container = document.getElementById('quiz-container');
            const topicDisplay = document.getElementById('quiz-topic-display');

            // UI Loading
            btnText.classList.add('hidden');
            loader.classList.remove('hidden');
            container.classList.add('hidden');

            const prompt = `
                Generate a single multiple-choice question (MCQ) about "${topic}" specifically according to the Hanbali Madhhab as presented in the book "Daleel Al-Talib".
                Return ONLY a JSON object with this structure:
                {
                    "question": "The question text in Arabic",
                    "options": ["Option 1 in Arabic", "Option 2 in Arabic", "Option 3 in Arabic", "Option 4 in Arabic"],
                    "correctIndex": 0,
                    "explanation": "A brief explanation of why this is the correct answer in Arabic"
                }
                Do not include markdown formatting like \`\`\`json. Just the raw JSON.
            `;

            try {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                };

                const responseText = await callGeminiAPI(payload);
                if (!responseText) throw new Error("Empty response");

                // --- FIX: Clean response text before parsing ---
                let cleanText = responseText.trim();
                if (cleanText.startsWith('```json')) {
                    cleanText = cleanText.replace(/^```json/, '').replace(/```$/, '');
                } else if (cleanText.startsWith('```')) {
                    cleanText = cleanText.replace(/^```/, '').replace(/```$/, '');
                }
                cleanText = cleanText.trim();
                // -----------------------------------------------

                currentQuizData = JSON.parse(cleanText);

                // Render Quiz
                topicDisplay.innerText = topic;
                document.getElementById('quiz-question').innerText = currentQuizData.question;
                
                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = '';
                document.getElementById('quiz-feedback').classList.add('hidden');

                currentQuizData.options.forEach((opt, index) => {
                    const div = document.createElement('div');
                    div.className = "quiz-option bg-white border border-gray-300 p-4 rounded-lg flex items-center shadow-sm";
                    div.innerHTML = `<span class="w-8 h-8 rounded-full border border-gray-400 flex items-center justify-center mr-3 text-sm font-bold text-gray-600 ml-3 shrink-0">${index + 1}</span> <span class="text-base md:text-lg">${opt}</span>`;
                    div.onclick = () => checkAnswer(index, div);
                    optionsContainer.appendChild(div);
                });

                container.classList.remove('hidden');

            } catch (error) {
                console.error("Quiz Error:", error);
                alert("ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.");
            } finally {
                loader.classList.add('hidden');
                btnText.classList.remove('hidden');
            }
        }

        function checkAnswer(selectedIndex, element) {
            if(!currentQuizData) return;
            
            const allOptions = document.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => opt.onclick = null); // Disable further clicks

            if (selectedIndex === currentQuizData.correctIndex) {
                element.classList.add('correct');
            } else {
                element.classList.add('incorrect');
                allOptions[currentQuizData.correctIndex].classList.add('correct');
            }

            // Show explanation
            const feedback = document.getElementById('quiz-feedback');
            document.getElementById('quiz-explanation').innerText = currentQuizData.explanation;
            feedback.classList.remove('hidden');
        }


        // --- DATA DATASETS ---

        const editionsData = [
            {
                id: 1,
                title: "ุทุจุนุฉ ูุธุฑ ุงููุฑูุงุจู",
                publisher: "ุฏุงุฑ ุทูุจุฉ",
                tags: ["student", "academic"],
                features: ["ุฏูุฉ ุถุจุท ุงููุต", "ุนูุงูุฉ ูุงุฆูุฉ ุจุงูุชุดููู", "ููุงูุด ูููุฏุฉ ูููุฑูู"],
                verdict: "ุชุนุชุจุฑ ุนูุฏ ุงููุซูุฑูู ุฃุฌูุฏ ุงูุทุจุนุงุช ูุฃุตุญูุง ูุตุงู.",
                color: "green"
            },
            {
                id: 2,
                title: "ุทุจุนุฉ ุณูุทุงู ุงูุนูุฏ",
                publisher: "ุฏุงุฑ ุฑูุงุฆุฒ",
                tags: ["student"],
                features: ["ุฅุฎุฑุงุฌ ููู ุฑุงุฆุน", "ูุดุฌุฑุฉ ููุจูุจุฉ", "ุฃููุงู ูุณุงุนุฏุฉ ููุญูุธ"],
                verdict: "ุงูุฃูุถู ููู ูุฑูุฏ ุงูุญูุธุ ูุฑูุญุฉ ุฌุฏุงู ููุนูู.",
                color: "blue"
            },
            {
                id: 3,
                title: "ุทุจุนุฉ ุนุจุฏุงูุณูุงู ุงูุดููุนุฑ",
                publisher: "ุฏุงุฑ ุฑูุงุฆุฒ (ุงููุชู)",
                tags: ["student", "academic"],
                features: ["ุชุญููู ุนููู ุฑุตูู", "ููุงุจูุฉ ุนูู ูุณุฎ ุฎุทูุฉ ูููุณุฉ"],
                verdict: "ุทุจุนุฉ ุนูููุฉ ูุญููุฉ ูุนุชูุฏ ุนูููุง.",
                color: "heritage"
            },
            {
                id: 4,
                title: "ุทุจุนุฉ ุงูููุชุจ ุงูุฅุณูุงูู",
                publisher: "ุงูููุชุจ ุงูุฅุณูุงูู",
                tags: ["classic"],
                features: ["ูุฏููุฉ ููุชุฏุงููุฉ", "ุฑุฎูุตุฉ ุงูุซูู"],
                verdict: "ุฌูุฏุฉ ูููู ุงููุณุฎ ุงูุฌุฏูุฏุฉ ูุงูุชูุง ูู ุงูุฎุฏูุฉ ูุงูุถุจุท.",
                color: "gray"
            }
        ];

        const shuruhData = [
            {
                id: 1,
                title: "ููู ุงููุขุฑุจ ุจุดุฑุญ ุฏููู ุงูุทุงูุจ",
                author: "ุงูุชุบูุจู (ุชูููุฐ ุงููุคูู)",
                type: "classic",
                desc: "ุงูุดุฑุญ ุงููุนุชูุฏ ุงูุฐู ูุญู ุฃููุงุธ ุงููุชู ุจุฏูุฉ ุฏูู ุงุณุชุทุฑุงุฏ.",
                level: "ูุชูุณุท"
            },
            {
                id: 2,
                title: "ููุงุฑ ุงูุณุจูู",
                author: "ุงุจู ุถููุงู",
                type: "classic",
                desc: "ุฃุดูุฑ ุงูุดุฑูุญ ุงููุชุฃุฎุฑุฉุ ูุชููุฒ ุจุฐูุฑ ุงูุฏููู ูุชุฎุฑูุฌ ุงูุฃุญุงุฏูุซ.",
                level: "ูุชูุฏู"
            },
            {
                id: 3,
                title: "ุงููุนุชูุฏ ูู ููู ุงูุฅูุงู ุฃุญูุฏ",
                author: "ุนูู ุงูููุฏู",
                type: "classic",
                desc: "ุญุงุดูุฉ ูุดุฑุญ ูููุฏ ุฌุฏุงู ูุฌูุน ุดูุงุฑุฏ ุงููุฐูุจ.",
                level: "ูุชูุฏู"
            },
            {
                id: 4,
                title: "ุงูุดุฑุญ ุงูููุชุน (ุดุฑุญ ุตูุชู ููุฑุบ)",
                author: "ุงูุดูุฎ ูุญูุฏ ุจู ุนุซูููู",
                type: "contemporary",
                desc: "ุนูู ููุงุฑ ุงูุณุจููุ ููู ูุฏุฑุณุฉ ููููุฉ ูุชูุงููุฉ ูู ุงูุชุนููู ูุงูุชุฑุฌูุญ.",
                level: "ูุชูุฏู"
            },
            {
                id: 5,
                title: "ุดุฑุญ ุงูุดูุฎ ุฃุญูุฏ ุงููุนููู",
                author: "ุงูุดูุฎ ุฃุญูุฏ ุงููุนููู",
                type: "audio",
                desc: "ุดุฑุญ ุชุญูููู ุฏููู ุฌุฏุงู ููู ููุธุฉุ ููุชุงุฒ ููุชุฃุณูุณ ุงููุชูู.",
                level: "ูุจุชุฏุฆ/ูุชูุณุท"
            },
            {
                id: 6,
                title: "ุดุฑุญ ุงูุดูุฎ ูุทูู ุงูุฌุงุณุฑ",
                author: "ุงูุดูุฎ ูุทูู ุงูุฌุงุณุฑ",
                type: "audio",
                desc: "ุดุฑุญ ูุงุถุญ ูุณูุณุ ูุฑูุฒ ุนูู ุชุตููุฑ ุงููุณุงุฆู.",
                level: "ูุจุชุฏุฆ"
            },
            {
                id: 7,
                title: "ุดุฑุญ ุงูุดูุฎ ูุญูุฏ ุจุงุฌุงุจุฑ",
                author: "ุงูุดูุฎ ูุญูุฏ ุจุงุฌุงุจุฑ",
                type: "audio",
                desc: "ุดุฑุญ ุชุฃุตููู ูุนุชูู ุจุงููุฐูุจ ูุงูุฑูุงูุงุช.",
                level: "ูุชูุฏู"
            }
        ];

        // --- NAVIGATION LOGIC ---
        function switchSection(sectionId) {
            // Hide all sections
            ['overview', 'editions', 'explanations', 'advisor', 'aitutor'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
                document.getElementById(`nav-${id}`).classList.remove('tab-active');
                document.getElementById(`nav-${id}`).classList.add('tab-inactive');
            });

            // Show selected
            document.getElementById(sectionId).classList.remove('hidden');
            document.getElementById(`nav-${sectionId}`).classList.add('tab-active');
            document.getElementById(`nav-${sectionId}`).classList.remove('tab-inactive');
        }

        // --- EDITIONS RENDER LOGIC ---
        function renderEditions(filter = 'all') {
            const container = document.getElementById('editions-grid');
            container.innerHTML = '';

            const filtered = editionsData.filter(item => filter === 'all' || item.tags.includes(filter));

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = `bg-white rounded-xl shadow-md overflow-hidden card-hover border-t-4 border-${item.color === 'green' ? 'heritage-green' : item.color === 'blue' ? 'blue-600' : 'heritage-dark'}`;
                card.innerHTML = `
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-1">${item.title}</h3>
                        <p class="text-sm text-gray-500 mb-4">${item.publisher}</p>
                        <div class="space-y-2 mb-4">
                            ${item.features.map(f => `<div class="flex items-center text-sm text-gray-700"><span class="ml-2 text-heritage-green">โ</span>${f}</div>`).join('')}
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-sm italic text-gray-600 border-r-2 border-heritage-gold">
                            "${item.verdict}"
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterEditions(type) {
            renderEditions(type);
        }

        // --- SHURUH RENDER LOGIC ---
        function renderShuruh(filter = 'all') {
            const container = document.getElementById('shuruh-list');
            container.innerHTML = '';

            const filtered = shuruhData.filter(item => filter === 'all' || item.type === filter || (filter === 'contemporary' && item.type === 'audio'));

            filtered.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex flex-col md:flex-row bg-white p-4 rounded-lg shadow-sm hover:bg-gray-50 transition border-r-4 " + (item.type === 'classic' ? 'border-heritage-dark' : 'border-heritage-accent');
                
                let icon = item.type === 'audio' ? '๐ง' : '๐';
                let typeLabel = item.type === 'classic' ? 'ุชุฑุงุซู' : item.type === 'audio' ? 'ุตูุชู' : 'ูุนุงุตุฑ';

                itemDiv.innerHTML = `
                    <div class="md:w-1/6 flex flex-col justify-center items-center text-3xl mb-3 md:mb-0 text-heritage-dark opacity-80">
                        ${icon}
                        <span class="text-xs font-sans font-bold mt-1">${typeLabel}</span>
                    </div>
                    <div class="md:w-5/6">
                        <div class="flex justify-between items-start">
                            <h4 class="text-lg font-bold text-gray-800">${item.title}</h4>
                            <span class="bg-gray-100 text-xs px-2 py-1 rounded text-gray-600">${item.level}</span>
                        </div>
                        <p class="text-sm text-heritage-dark font-medium mb-1">${item.author}</p>
                        <p class="text-sm text-gray-600">${item.desc}</p>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        function filterShuruh() {
            const selected = document.querySelector('input[name="shuruh-type"]:checked').value;
            renderShuruh(selected);
        }

        // --- ADVISOR LOGIC ---
        function getRecommendation() {
            const level = document.getElementById('user-level').value;
            const goal = document.getElementById('user-goal').value;
            const resultDiv = document.getElementById('advisor-result');
            const contentDiv = document.getElementById('recommendation-content');
            
            let recText = "";
            let editionRec = "";
            let explanationRec = "";

            // Logic Tree
            if (level === 'beginner') {
                editionRec = "ููุตุญู ุจุทุจุนุฉ <b>ุณูุทุงู ุงูุนูุฏ (ุฏุงุฑ ุฑูุงุฆุฒ)</b> ูุฃููุง ูุดุฌุฑุฉ ูููููุฉ ูุชุณุงุนุฏ ุนูู ุงูุชุตูุฑ ูุงูุญูุธ.";
                explanationRec = "ุงุจุฏุฃ ุจุณูุงุน ุดุฑุญ <b>ุงูุดูุฎ ูุทูู ุงูุฌุงุณุฑ</b> ูุณูููุชูุ ุฃู ุดุฑุญ <b>ุงูุดูุฎ ุฃุญูุฏ ุงููุนููู</b> ุฅุฐุง ููุช ุชุญุจ ุงูุฏูุฉ ูุงูุชูุตูู ูู ุงูุจุฏุงูุฉ.";
            } else if (level === 'intermediate') {
                editionRec = "ุทุจุนุฉ <b>ูุธุฑ ุงููุฑูุงุจู</b> ูู ุงูุฃูุณุจ ูู ูุฏูุฉ ุถุจุทูุง.";
                if (goal === 'evidence') {
                    explanationRec = "ุนููู ุจูุชุงุจ <b>ููุงุฑ ุงูุณุจูู</b> ูุงุจู ุถููุงูุ ููู ูุฑูุฒ ุจุดุฏุฉ ุนูู ุงูุฃุฏูุฉ.";
                } else {
                    explanationRec = "ุทุงูุน <b>ููู ุงููุขุฑุจ</b> ููู ุงูุนุจุงุฑุฉุ ูุงุณุชูุน ูุดุฑุญ <b>ุงูุดูุฎ ูุญูุฏ ุจุงุฌุงุจุฑ</b> ููุชุฃุตูู.";
                }
            } else { // Advanced
                editionRec = "ููุถู ุงูุชูุงุก <b>ุทุจุนุฉ ุงููุจุฏู (ุงูููุชุจุฉ ุงูุฅุณูุงููุฉ)</b> ูุนูููุง ุญุงุดูุฉ ุงููุจุฏู ูููุงุฆุณูุง.";
                explanationRec = "ุฏุฑุงุณุฉ <b>ุญุงุดูุฉ ุงููุจุฏู</b> ู <b>ุงููุนุชูุฏ</b>ุ ูููุงุฑูุชูุง ุจูุง ูู <b>ูุดุงู ุงูููุงุน</b>.";
            }

            contentDiv.innerHTML = `
                <div class="mb-2">๐ <strong>ุงููุณุฎุฉ:</strong> ${editionRec}</div>
                <div>๐๏ธ <strong>ุงูุดุฑุญ:</strong> ${explanationRec}</div>
            `;
            
            document.getElementById('advisor-form').classList.add('hidden');
            resultDiv.classList.remove('hidden');
        }

        function resetAdvisor() {
            document.getElementById('advisor-form').classList.remove('hidden');
            document.getElementById('advisor-result').classList.add('hidden');
        }

        // --- CHART.JS INITIALIZATION ---
        let chartInstance = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Init content
            renderEditions();
            renderShuruh();

            // Init Chart
            const ctx = document.getElementById('commentaryChart').getContext('2d');
            
            // Data points: x = Depth (Concise -> Detailed), y = Focus (Wording -> Evidence)
            const scatterData = [
                { x: -0.8, y: -0.5, r: 10, label: "ููู ุงููุขุฑุจ", type: "ูู ุนุจุงุฑุฉ" }, 
                { x: 0.5, y: 0.9, r: 15, label: "ููุงุฑ ุงูุณุจูู", type: "ุฃุฏูุฉ" }, 
                { x: 0.8, y: -0.2, r: 12, label: "ุญุงุดูุฉ ุงููุจุฏู", type: "ุชุฏููู ูููู" }, 
                { x: 0.9, y: 0.7, r: 20, label: "ุงูุดุฑุญ ุงูููุชุน", type: "ุชุนูููู ุดุงูู" }, 
                { x: -0.2, y: -0.2, r: 8, label: "ุงููุชู ุงูุฃุตูู", type: "ุงููุชู" }
            ];

            // Use the new font family in Chart.js
            Chart.defaults.font.family = "'Rubik', sans-serif";
            
            // Adjust chart options for mobile
            const isMobile = window.innerWidth < 768;

            chartInstance = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'ุงูุดุฑูุญ',
                        data: scatterData,
                        backgroundColor: function(context) {
                            const val = context.raw?.type;
                            if(val === 'ุงููุชู') return '#3E2723';
                            if(val === 'ุฃุฏูุฉ') return '#2E7D32';
                            return 'rgba(188, 170, 164, 0.8)';
                        },
                        borderColor: '#3E2723',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.label + " (" + context.raw.type + ")";
                                }
                            },
                            bodyFont: { family: "'Rubik', sans-serif" }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'ุงูุฅูุฌุงุฒ  <---------->  ุงูุชูุตูู ูุงูุฅุทูุงุจ', font: { family: "'Rubik', sans-serif", size: isMobile ? 10 : 12 } },
                            min: -1, max: 1.5,
                            grid: { color: '#eee' },
                            ticks: { font: { size: isMobile ? 10 : 12 } }
                        },
                        y: {
                            title: { display: true, text: 'ุญู ุงูุฃููุงุธ  <---------->  ุฐูุฑ ุงูุฃุฏูุฉ ูุงูุชุนููู', font: { family: "'Rubik', sans-serif", size: isMobile ? 10 : 12 } },
                            min: -1, max: 1.5,
                            grid: { color: '#eee' },
                            ticks: { font: { size: isMobile ? 10 : 12 } }
                        }
                    }
                }
            });
        });

    </script>
</body>
</html>

